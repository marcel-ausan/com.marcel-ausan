[rules]
rule_0 = Equity: Isin+Currency+Exchange
rule_1 = Unknow CFI Code: Exdestination + Symbol + Currency
rule_2 = Future: MaturityDate + ProductCode+Exdestination
rule_3 = Option: MaturityDate+ProductCode+Exdestination+StrikePrice+CFICode
rule_4 = Specific case> Future: MaturityDate + Isin + Exdestination
rule_5 = Workaround when wrong product code: Instrument Description + currency + exchange
rule_6 = Workaround - check maturity: Instrument Description + currency + exchange + maturity
rule_7 = Future: MaturityDate +Symbol + Exdest

[rules/rule_0/properties]
type = standard

[rules/rule_0/result]
real_found = real
fungible_found = preferred_real

[rules/rule_0/search]
condition = if (startsWith($CFICODE,"E") and not empty($ISINCODE))
ULFLOW.request.plugin = ODS
ULFLOW.request.timeout = 100
ISINCODE = isin-code
CURRENCY = price-currency
EXDESTINATION = trading-venue, mapping_0

[rules/rule_1/properties]
type = standard

[rules/rule_1/result]
real_found = real
fungible_found = preferred_real

[rules/rule_1/search]
condition = if (startsWith($CFICODE,"X") or startsWith($CFICODE,"FM"))
ULFLOW.request.plugin = ODS
ULFLOW.request.timeout = 100
EXDESTINATION = trading-venue, mapping_0
SYMBOL = symbol
CURRENCY = price-currency

[rules/rule_2/properties]
type = standard

[rules/rule_2/result]
real_found = real
fungible_found = preferred_real

[rules/rule_2/search]
condition = if (startsWith($CFICODE,"F"))
ULFLOW.request.plugin = ODS
ULFLOW.request.timeout = 100
MATURITYDATE = idc-expiration-date
BASE = product-code
EXDESTINATION = trading-venue, mapping_0
CFICODE = cfi-code

[rules/rule_3/properties]
type = standard

[rules/rule_3/result]
real_found = real
fungible_found = preferred_real

[rules/rule_3/search]
condition = if (startsWith($CFICODE,"O"))
ULFLOW.request.plugin = ODS
ULFLOW.request.timeout = 100
MATURITYDATE = idc-expiration-date
BASE = product-code
EXDESTINATION = trading-venue, mapping_0
STRIKEPRICE = strike-price
CFICODE = cfi-code

[rules/rule_4/properties]
type = standard

[rules/rule_4/result]
real_found = real
fungible_found = fungible

[rules/rule_4/search]
condition = if (startsWith($CFICODE,"F"))
ULFLOW.request.plugin = ODS
ULFLOW.request.timeout = 100
MATURITYDATE = idc-expiration-date
ISINCODE = isin-code
EXDESTINATION = trading-venue
CFICODE = cfi-code

[rules/rule_5/properties]
type = standard

[rules/rule_5/result]
real_found = real
fungible_found = fungible

[rules/rule_5/search]
condition = if (not empty($SECURITYDESC))
ULFLOW.request.plugin = ODS
ULFLOW.request.timeout = 100
SECURITYDESC = description
CURRENCY = price-currency
EXDESTINATION = trading-venue, mapping_0

[rules/rule_6/properties]
type = standard

[rules/rule_6/result]
real_found = real
fungible_found = fungible

[rules/rule_6/search]
condition = if not empty($SECURITYDESC)
ULFLOW.request.plugin = ODS
ULFLOW.request.timeout = 100
SECURITYDESC = description
CURRENCY = price-currency
EXDESTINATION = trading-venue, mapping_0
MATURITYDATE = idc-expiration-date

[rules/rule_7/properties]
type = standard

[rules/rule_7/result]
real_found = real
fungible_found = fungible

[rules/rule_7/search]
condition = if (startsWith($CFICODE,"F"))
ULFLOW.request.plugin = ODS
ULFLOW.request.timeout = 100
SYMBOL = symbol
MATURITYDATE = idc-expiration-date
EXDESTINATION = trading-venue

[mappings]
mapping_0 = Exchanges

[mapping/mapping_0]
XCEC = XCEC|XNYM|
XPAR = XPAR|ALXP|
XSES = XSIM|
XMIL = XMIL|ETFP|MIVX|MOTX|MTAA|MTAH|SEDX|XAIM|XDMI|XMOT|
XMAD = XMCE|
XVIE = XVIE|XWBO|WBAH|WBDM|WBGF|XCEG|
IFLL = IFLL|IFEU|
XSTO = XSTO|FNSE|XSAT|CLJP|CSTO|XOPV|

[convert-currencies]
GBP = False
ILS = False
ZAR = True
USD = True
AUD = False

[enrich-tags]
EXCHANGECODEETI = etilocalcode
LEGEXCHANGECODEETI = etilocalcode
MATURITYMONTHYEAR = maturity-date
OPTATTRIBUTE = time-issue
EXCHANGECODE = liffe-exchangecode
PRODUCTCODE = product-code
ECHEANCE = maturity-date-full
UNDERLINE.CODE = underlying-local-code
PUTORCALL = put-or-call
EUREX_CONTRACTVERSION = eurex-contractversion
ULCFICODE = cfi-code
ETILOCALCODE = etilocalcode
SECURITYEXCHANGE = trading-venue
EXDESTINATION = trading-venue
CURRENCY = price-currency
SECURITYTYPE = security-type
EUREX = eurex
LEGEXCHANGECODE = liffe-exchangecode
INITIALMARGIN = margin-per-contract
LIFFE_DISPLAYPRECISION = displayprecision
LEGPRICE = legprice
STRIKEPRICE = strike-price
CFICODE = cfi-code
EXPIRATIONDATE = idc-expiration-date
ISINCODE = isin-code
REALCODE = local-code
INSTRUMENTEXPIRYDATE = maturity-date-full
ULTYPE = type
SYMBOL = symbol
LEGUNDERLINECODE = underlying-local-code
LIFFE = liffe
CLOSINGPRICE = closing-price
UNDERLYINGDESCRIPTION = underlying-symbol
ORIGINALMIC = ORIGINALMIC

[enrich-tags/legs]
EXDESTINATION = trading-venue
CURRENCY = price-currency
SECURITYTYPE = cfi-code
EUREX = eurex
LEGPUTORCALL = put-or-call
LEGEXCHANGECODE = liffe-exchangecode
LEGSIDE = side
LEGSTRIKEPRICE = strike-price
EXCHANGECODEETI = etilocalcode
LIFFE_DISPLAYPRECISION = displayprecision
LEGPRICE = legprice
LEGEXCHANGECODEETI = etilocalcode
STRIKEPRICE = strike-price
LEGMATURITYMONTHYEAR = maturity-date
OPTATTRIBUTE = time-issue
EXCHANGECODE = liffe-exchangecode
LEGSYMBOL = symbol
UNDERLINE.CODE = underlying-local-code
EUREX_CONTRACTVERSION = eurex-contractversion
ETILOCALCODE = etilocalcode
LEGRATIOQTY = ratio-quantity
LEGUNDERLINECODE = underlying-local-code
LIFFE = liffe
